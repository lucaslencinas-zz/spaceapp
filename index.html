<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>GOT a flight</title>


    <link rel="stylesheet" href="codepen-steps/css/reset.css">
    <link rel="stylesheet" href="codepen-steps/css/style.css">
    <link rel="stylesheet" href="styleTimepicker.css">

    <script src="js/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.4/hammer.min.js"></script>
    <script  src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js" ></script>

  </head>

  <body>

    <!-- multistep form -->
<form id="msform">
  <!-- progressbar -->
  <ul id="progressbar">
    <li class="active">Airports</li>
    <li>Flight date and time</li>
    <li>Results</li>
  </ul>
  <!-- fieldsets -->
  <fieldset>
    <h2 class="fs-title">Airports</h2>
    <h3 class="fs-subtitle">Enter flight information</h3>

    <select id="selectAeropuertoDesde" placeholder="Desde">
      <option name="KORD">Chicago (KORD)</option>
      <option name="KLGA">LaGuardia (KLGA)</option>
      <option name="KEWR">Newark (KEWR)</option>
      <option name="KJFK">New York (KJFK)</option>
      <option name="KPHL">Philadelphia (KPHL)</option>
      <option name="KSFO">San Francisco (KSFO)</option>
    </select>
    <select id="selectAeropuertoHasta" placeholder="Hasta">
      <option name="KORD">Chicago (KORD)</option>
      <option name="KLGA">LaGuardia (KLGA)</option>
      <option name="KEWR">Newark (KEWR)</option>
      <option name="KJFK">New York (KJFK)</option>
      <option name="KPHL">Philadelphia (KPHL)</option>
      <option name="KSFO">San Francisco (KSFO)</option>
    </select>
    <!--<input type="button" name="previous" class="previous action-button" value="Previous" />-->
    <input type="button" name="next" class="next action-button" value="Next" />
  </fieldset>
  <fieldset>
    <h2 class="fs-title">Flight date and time</h2>
    <h3 class="fs-subtitle">Select the time of your flight</h3>
    <!-- Time Picker -->
  <div class="swipe" id="DP-date">
      <div class='swipe-wrap'>

      </div>
    </div>
  <div class="picker-container"></div>
  <!-- Fin Time Picker  -->

    <input type="button" name="previous" class="previous action-button" value="Previous" />
    <input type="button" name="next" id="search" class="next action-button" value="Search" />
  </fieldset>
  <fieldset>
    <h2 class="fs-title">Results</h2>
    <h3 class="fs-subtitle">Your flight forecast is...</h3>

    <span  class="fs-title">Probability of delay: </span><br><span class="fs-subtitle" id="probabilityOfDelay"></span><br><br>
    <span  class="fs-title">Delayed Airport: </span><br><span class="fs-subtitle" id="delayedAirport"></span><br><br>
    <span  class="fs-title">Reasons of Delay: </span><br><span class="fs-subtitle" id="reasonsOfDelay"></span><br><br>
    <input type="button" name="previous" class="previous action-button" value="Modify" />
    <input type="button" name="submit" class="submit action-button" value="New Flight" />
  </fieldset>
</form>

  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>
  <script src="codepen-steps/js/index.js"></script>
  <script src="indexTimepicker.js"></script>

  <style>
  </style>

  <script type="text/javascript">
      var probabilidad = ["UNLIKELY", "LOW", "MEDIUM", "HIGH", "VERY HIGH"];
      var apiurl = "http://private-e158e-clearfortakeoff.apiary-mock.com/probability"
      var meses = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dic"];
      $(function() {
        $(".swipe-wrap > div").click(function(){
          $(".swipe-wrap > .active").toggleClass("active");
          $( this ).toggleClass( "active" );
        });

        $("#search").click(function(){
          var hora = $(".kitkat-am-pm").text() == "PM" ? 12 + +$(".kitkat-hour").text() : $(".kitkat-hour").text();
          console.log("date: " + formatearFecha($(".swipe-wrap > .active").text()));
          console.log("hour: " + formatearHora($(".kitkat-minute").text(), hora));
          console.log("origin:" + $("#selectAeropuertoDesde").find('option:selected').attr("name"));
          console.log("destiny:" + $("#selectAeropuertoHasta").find('option:selected').attr("name"));
          $.ajax({
              crossDomain: true,
              type:"GET",
              contentType: "application/json; charset=utf-8",
              url: apiurl,
              dataType: "json",
              success: function(data) {

                renderResponse(data);
              },
              error: function() { alert('Failed!'); },
          }); /*end ajax*/
        });/*end search click*/
      });

      function formatearFecha(fechaForm){
        var mesString = fechaForm.substring(fechaForm.length -3, fechaForm.length);
        var diaString = fechaForm.substring(0, fechaForm.length -3);
        if (diaString < 10){
          diaString = "0" + diaString;
        }
        var mesNumero = meses.indexOf(mesString) + 1;
        if (mesNumero < 10){
          mesNumero = "0" + mesNumero;
        }
        return "2016" + mesNumero + diaString;
      }

      function formatearHora(minuteForm, horaForm){
        var horaString = "";
        var minutoString = "";
        minutoString = minuteForm;

        if (horaForm < 10){
          horaString = "0" + horaForm;
        }else {
          horaString = horaForm;
        }

        return horaString + minutoString;
      }

      function renderResponse(data){
        var lugar = "";
        $("#probabilityOfDelay").text(probabilidad[data.probability -1]);
        if(data.source == "origin"){
          $("#delayedAirport").text($("#selectAeropuertoDesde").find('option:selected').text());
        }
        else {
          $("#delayedAirport").text($("#selectAeropuertoHasta").find('option:selected').text());
        }
        $("#reasonsOfDelay").text(data.reasons);
      }

  </script>
  </body>
</html>
